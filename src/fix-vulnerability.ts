
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function fixVulnerabilityLevels() {
  try {
    const citizens = await prisma.seniorCitizen.findMany({
      where: {
        vulnerabilityLevel: {
          contains: 'Risk'
        }
      }
    });

    console.log(`Found ${citizens.length} citizens with incorrect vulnerability suffix.`);

    for (const citizen of citizens) {
      const newLevel = citizen.vulnerabilityLevel.replace(' Risk', '').trim();
      console.log(`Updating ${citizen.id}: '${citizen.vulnerabilityLevel}' -> '${newLevel}'`);

      await prisma.seniorCitizen.update({
        where: { id: citizen.id },
        data: { vulnerabilityLevel: newLevel }
      });
    }

    console.log('Update complete.');

  } catch (error) {
    console.error('Error:', error);
  } finally {
    await prisma.$disconnect();
  }
}

fixVulnerabilityLevels();
